<!DOCTYPE html>
<html>
<head>
    <script src="phaser.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: true,
                overlapBias: 8,
                tileBias: 32,
                fps: 60,
                fixedStep: true
            }
        },
        pixelArt: true,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var rect = undefined;
    var rect2 = undefined;
    var cursorKeys = undefined;
    var layer1 = undefined;
    var mario = undefined;

    function preload ()
    {
        this.load.setBaseURL('http://localhost:7777/');
        this.load.tilemapTiledJSON('tilejson', 'map/test.json');
        this.load.image('tiles', 'tiles.png');
        this.load.image('mario', 'mario.png');

        
    }

    function create ()
    {
        cursorKeys = this.input.keyboard.createCursorKeys();
        var map = this.add.tilemap('tilejson');
        //this.physics.add.existing(map);
        var tileset = map.addTilesetImage('test', 'tiles');
        ground = map.createLayer('ground', tileset, 0,0);
        
        layer1 = map.createLayer('layer1', tileset, 0,0);
        layer1.setCollisionByProperty({collide:true});
        console.dir(layer1)
        // layer1.body.setPushable(true);
        // layer1.body.pushable = false ;
        // layer1.setCollisionByExclusion([1]);
        layer2 = this.physics.add.existing(layer1);
        // this.physics.layer1.setPushable(false);
        console.dir(this.physics);
        
        // mario = this.physics.add.image(200,200, 'mario');
        mario1 = this.add.sprite(10, 10, 'mario');
        // mario.set
        mario = this.physics.add.existing(mario1);
        
        this.physics.add.collider(mario, layer1);


        // rect.setCollideWorldBounds(true);

        const debugGraphics = this.add.graphics().setAlpha(0.75);
        layer1.renderDebug(debugGraphics, {
            tileColor: null, // Color of non-colliding tiles
            collidingTileColor: new Phaser.Display.Color(243, 134, 48, 255), // Color of colliding tiles
            faceColor: new Phaser.Display.Color(40, 39, 37, 255) // Color of colliding face edges
        });
        
    }
    function update ()
    {
        var isUpDown = cursorKeys.up.isDown;
        var isDownDown = cursorKeys.down.isDown;
        var isLeftDown = cursorKeys.left.isDown;
        var isRightDown = cursorKeys.right.isDown;
        var isSpaceDown = cursorKeys.space.isDown;
        var isShiftDown = cursorKeys.shift.isDown;
        var speed= 600;
        

        if(isUpDown) {
            mario.body.setVelocityY (-speed)
        }
        if(isDownDown) {
            mario.body.setVelocityY (+speed)
        }
        if(!isDownDown && !isUpDown) {
            mario.body.setVelocityY (0)
        }
        if(isLeftDown) {
            mario.body.setVelocityX (-speed)
        }
        if(isRightDown) {
            mario.body.setVelocityX (speed)
        }
        if(!isRightDown && !isLeftDown) {
            mario.body.setVelocityX (0)
        }
        if(isSpaceDown){
            console.log(layer1);
            console.log(mario);
        }
    }
    </script>

</body>
</html>