<!DOCTYPE html>
<html>
<head>
    <script src="phaser.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 576,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false,
                overlapBias: 8,
                tileBias: 32,
                fps: 60,
                fixedStep: true
            }
        },
        pixelArt: true,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var rect = undefined;
    var rect2 = undefined;
    var cursorKeys = undefined;
    var layer1 = undefined;
    var mario = undefined;
    var collisionGroup = [];

    function preload ()
    {
        this.load.setBaseURL('http://localhost:7777/');
        this.load.tilemapTiledJSON('tilejson', 'map/test.json');
        this.load.image('tiles', 'tiles.png');
        this.load.image('mario', 'mario.png');

        
    }

    function create ()
    {
        cursorKeys = this.input.keyboard.createCursorKeys();
        var map = this.add.tilemap('tilejson');
        var tileset = map.addTilesetImage('test', 'tiles');
        ground = map.createLayer('ground', tileset, 0,0);
        
        mario = this.physics.add.sprite(30, 30, 'mario').setBounce(1, 1).setCollideWorldBounds(true).setScale(2);
        layer1 = map.createLayer('layerblock', tileset, 0,0);
        layer1.setCollisionByProperty({collide:true}, true, true);

        var layerPhysics = this.physics.add.existing(layer1);
        layerPhysics.body.pushable = false;
        mario.collideWorldBounds = true;
        
        layer1.forEachTile(function(tile) {
            if(tile.canCollide) {
                collisionGroup.push(tile);
            }
        });

        if(config.physics.debug) {
            const debugGraphics = this.add.graphics().setAlpha(0.75);
            layerPhysics.renderDebug(debugGraphics, {
                tileColor: null, // Color of non-colliding tiles
                collidingTileColor: new Phaser.Display.Color(243, 134, 48, 255), // Color of colliding tiles
                faceColor: new Phaser.Display.Color(40, 39, 37, 255) // Color of colliding face edges
            });
        }
    }
    
    function update ()
    {
        this.physics.collideTiles(mario, collisionGroup);
        var isUpDown = cursorKeys.up.isDown;
        var isDownDown = cursorKeys.down.isDown;
        var isLeftDown = cursorKeys.left.isDown;
        var isRightDown = cursorKeys.right.isDown;
        var isSpaceDown = cursorKeys.space.isDown;
        var isShiftDown = cursorKeys.shift.isDown;
        var speed= 576/2;

        

        if(isUpDown) {
            mario.body.setVelocityY (-speed)
        }
        if(isDownDown) {
            mario.body.setVelocityY (+speed)
        }
        if(!isDownDown && !isUpDown) {
            mario.body.setVelocityY (0)
        }
        if(isLeftDown) {
            mario.body.setVelocityX (-speed)
        }
        if(isRightDown) {
            mario.body.setVelocityX (speed)
        }
        if(!isRightDown && !isLeftDown) {
            mario.body.setVelocityX (0)
        }
        if(isSpaceDown){
            console.log(layer1);
            console.log(mario);
        }
    }
    </script>

</body>
</html>